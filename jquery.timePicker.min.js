/*
 * A time picker for jQuery
 *
 * Dual licensed under the MIT and GPL licenses.
 * Copyright (c) 2009-2011 Anders Fajerson
 * @name     timePicker
 * @author   Anders Fajerson (http://perifer.se)
 * @example  $("#mytime").timePicker();
 * @example  $("#mytime").timePicker({step:30, startTime:new Date(0, 0, 0, 15, 00, 0), endTime:"18:00", timeFormat:"hh:mm tt"});
 *
 * Based on timePicker by Sam Collet (http://www.texotela.co.uk)
 *
 * Modified by kds to work for jquery 3.5.1 and jquery.ui 1.12
 * 
 */
 
!function(p){function v(e,t,r){e.value=p(t).text(),p(e).change(),r.hide()}function H(e,t){if(e)return d(t,e)}function k(e,t){if("object"==typeof e)return(r=e).setFullYear(2001),r.setMonth(0),r.setDate(0),r;for(var r,s,i,n=t.timeFormat.match(/(hh?|HH?|mm?|ss?|tt?)/g),o=d(t,!1),a=new RegExp("^"+o+"$"),u=e.match(a),c=-1,m=-1,f=0,l=t.amDesignator,h=t.pmDesignator,g=0;g<n.length;g++)if(u&&u[g+1])switch(n[g]){case"hh":case"h":c=parseInt(u[g+1],10);break;case"HH":case"H":c=parseInt(u[g+1],10);break;case"mm":case"m":m=parseInt(u[g+1],10);break;case"ss":case"s":f=parseInt(u[g+1],10);break;case"t":l=l.substring(0,1),h=h.substring(0,1);case"tt":s=u[g+1]}if(12===c&&s===l?c=0:12!==c&&s===h&&(c+=12),(i=new Date(2001,0,0,c,m,f)).getHours()!=c||i.getMinutes()!=m||i.getSeconds()!=f)throw"Invalid time";return i}function d(s,i){function n(e){return e<10?"0"+e:e}return s.timeFormat.replace(/hh?|HH?|mm?|ss?|tt?/g,function(e){var t=s.amDesignator,r=s.pmDesignator;switch(e){case"hh":return i?n((i.getHours()+11)%12+1):"([0-1][0-9])";case"h":return i?(i.getHours()+11)%12+1:"([0-1]?[0-9])";case"HH":return i?n(i.getHours()):"([0-2][0-9])";case"H":return i?i.getHours():"([0-2]?[0-9])";case"mm":return i?n(i.getMinutes()):"([0-6][0-9])";case"m":return i?i.getMinutes():"([0-6]?[0-9])";case"ss":return i?n(i.getSeconds()):"([0-6][0-9])";case"s":return i?i.getSeconds():"([0-6]?[0-9])";case"t":return i?i.getHours()<12?t.substring(0,1):r.substring(0,1):"("+t.substring(0,1)+"|"+r.substring(0,1)+")";case"tt":return i?i.getHours()<12?t:r:"("+t+"|"+r+")"}return""})}p.fn.timePicker=function(e){var t;void 0===e||void 0===e.separator&&void 0===e.show24Hours||e.timeFormat||(t=void 0===e.show24Hours||e.show24Hours,e.timeFormat=(t?"HH":"hh")+(void 0!==e.separator?e.separator:":")+"mm"+(t?"":" tt"));var r=p.extend({},p.fn.timePicker.defaults,e);return this.each(function(){p.timePicker(this,r)})},p.timePicker=function(e,t){var r=p(e)[0];return r.timePicker||(r.timePicker=new jQuery._timePicker(r,t))},p.timePicker.version="0.4",p.timePicker.formatTime=function(e,t,r){return(r=r||p.fn.timePicker.defaults).timeFormat=e,H(t,r)},p.timePicker.parseTime=function(e,t,r){return(r=r||p.fn.timePicker.defaults).timeFormat=e,k(t,r)},p._timePicker=function(a,u){var e=!1,o=!1,c=k(u.startTime,u),m=k(u.endTime,u),f="selected",l="li."+f;p(a).attr("autocomplete","OFF");for(var t=[],r=new Date(c);r<=m;)t[t.length]=H(r,u),r=new Date(r.setMinutes(r.getMinutes()+u.step));for(var h=p('<div class="time-picker'+(u.show24Hours?"":" time-picker-12hours")+'"></div>'),g=p("<ul></ul>"),s=0;s<t.length;s++)g.append("<li>"+t[s]+"</li>");h.append(g),h.appendTo("body").hide(),h.mouseover(function(){e=!0}).mouseout(function(){e=!1}),p("li",g).mouseover(function(){o||(p(l,h).removeClass(f),p(this).addClass(f))}).mousedown(function(){e=!0}).click(function(){v(a,this,h),e=!1});function d(){if(h.is(":visible"))return!1;p("li",h).removeClass(f);var e=p(a).offset();h.css({top:e.top+a.offsetHeight,left:e.left}),h.show();var t=c;if(a.value)try{t=k(a.value,u);var r=60*c.getHours()+c.getMinutes(),s=60*t.getHours()+t.getMinutes()-r,i=Math.round(s/u.step),n=new Date(2001,0,0,0,i*u.step+r,0),t=c<n&&n<=m?n:c}catch(e){}var o=p("li:contains("+H(t,u)+")",h);return o.length&&(o.addClass(f),h[0].scrollTop=o[0].offsetTop),!0}p(a).focus(d).click(d),p(a).blur(function(){e||h.hide()});p(a).keydown(function(e){var t;o=!0;var r,s=h[0].scrollTop;switch(e.keyCode){case 38:if(d())return!1;var i=(t=p(l,g)).prev().addClass(f)[0];return i?(t.removeClass(f),i.offsetTop<s&&(h[0].scrollTop=s-i.offsetHeight)):(t.removeClass(f),i=p("li:last",g).addClass(f)[0],h[0].scrollTop=i.offsetTop-i.offsetHeight),!1;case 40:if(d())return!1;var n=(t=p(l,g)).next().addClass(f)[0];return n?(t.removeClass(f),n.offsetTop+n.offsetHeight>s+h[0].offsetHeight&&(h[0].scrollTop=s+n.offsetHeight)):(t.removeClass(f),n=p("li:first",g).addClass(f)[0],h[0].scrollTop=0),!1;case 13:return h.is(":visible")&&(r=p(l,g)[0],v(a,r,h)),!1;case 27:return h.hide(),!1}return!0}),p(a).keyup(function(e){o=!1}),this.getTime=function(){return k(a.value,u)},this.setTime=function(e){a.value=H(k(e,u),u),p(a).change()}},p.fn.timePicker.defaults={step:30,startTime:new Date(0,0,0,0,0,0),endTime:new Date(0,0,0,23,30,0),timeFormat:"HH:mm",amDesignator:"AM",pmDesignator:"PM"}}(jQuery);
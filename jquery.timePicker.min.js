(function(a){function c(b,c,d,e){b.value=a(c).text();a(b).change();if(!a.browser.msie){b.focus()}d.hide()}function d(a,b){var c=a.getHours();var d=b.show24Hours?c:(c+11)%12+1;var f=a.getMinutes();return e(d)+b.separator+e(f)+(b.show24Hours?"":c<12?" AM":" PM")}function e(a){return(a<10?"0":"")+a}function f(a,b){return typeof a=="object"?h(a):g(a,b)}function g(a,b){if(a){var c=a.split(b.separator);var d=parseFloat(c[0]);var e=parseFloat(c[1]);if(!b.show24Hours){if(d===12&&a.indexOf("AM")!==-1){d=0}else if(d!==12&&a.indexOf("PM")!==-1){d+=12}}var f=new Date(0,0,0,d,e,0);return h(f)}return null}function h(a){a.setFullYear(2001);a.setMonth(0);a.setDate(0);return a}var b={init:function(b){var c=a.extend({},a.fn.timePicker.defaults,b);return this.each(function(){a.timePicker(this,c)})},destroy:function(){return this.each(function(){if(this.timePicker){delete this.timePicker;a("div.time-picker").remove()}})}};a.fn.timePicker=function(c){if(b[c]){return b[c].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof c==="object"||!c){return b.init.apply(this,arguments)}else{a.error("Method "+c+" does not exist on jQuery.tooltip")}};a.timePicker=function(b,c){var d=a(b)[0];return d.timePicker||(d.timePicker=new jQuery._timePicker(d,c))};a.timePicker.version="0.4";a._timePicker=function(b,e){var i=false;var j=false;var k=f(e.startTime,e);var l=f(e.endTime,e);var m="selected";var n="li."+m;a(b).attr("autocomplete","OFF");var o=[];var p=new Date(k);while(p<=l){o[o.length]=d(p,e);p=new Date(p.setMinutes(p.getMinutes()+e.step))}var q=a('<div class="time-picker'+(e.show24Hours?"":" time-picker-12hours")+'"></div>');var r=a("<ul></ul>");for(var s=0;s<o.length;s++){r.append("<li>"+o[s]+"</li>")}q.append(r);q.appendTo("body").hide();q.mouseover(function(){i=true}).mouseout(function(){i=false});a("li",r).mouseover(function(){if(!j){a(n,q).removeClass(m);a(this).addClass(m)}}).mousedown(function(){i=true}).click(function(){c(b,this,q,e);i=false});var t=function(){if(q.is(":visible")){return false}a("li",q).removeClass(m);var c=a(b).offset();q.css({top:c.top+b.offsetHeight,left:c.left});q.show();var f=b.value?g(b.value,e):k;var i=k.getHours()*60+k.getMinutes();var j=f.getHours()*60+f.getMinutes()-i;var n=Math.round(j/e.step);var o=h(new Date(0,0,0,0,n*e.step+i,0));o=k<o&&o<=l?o:k;var p=a("li:contains("+d(o,e)+")",q);if(p.length){p.addClass(m);q[0].scrollTop=p[0].offsetTop}return true};a(b).focus(t).click(t);a(b).blur(function(){if(!i){q.hide()}});var u=a.browser.opera||a.browser.mozilla?"keypress":"keydown";a(b)[u](function(d){var f;j=true;var g=q[0].scrollTop;switch(d.keyCode){case 38:if(t()){return false}f=a(n,r);var h=f.prev().addClass(m)[0];if(h){f.removeClass(m);if(h.offsetTop<g){q[0].scrollTop=g-h.offsetHeight}}else{f.removeClass(m);h=a("li:last",r).addClass(m)[0];q[0].scrollTop=h.offsetTop-h.offsetHeight}return false;break;case 40:if(t()){return false}f=a(n,r);var i=f.next().addClass(m)[0];if(i){f.removeClass(m);if(i.offsetTop+i.offsetHeight>g+q[0].offsetHeight){q[0].scrollTop=g+i.offsetHeight}}else{f.removeClass(m);i=a("li:first",r).addClass(m)[0];q[0].scrollTop=0}return false;break;case 13:if(q.is(":visible")){var k=a(n,r)[0];c(b,k,q,e)}return false;break;case 27:q.hide();return false;break}return true});a(b).keyup(function(a){j=false});this.getTime=function(){return g(b.value,e)};this.setTime=function(c){b.value=d(f(c,e),e);a(b).change()}};a.fn.timePicker.defaults={step:30,startTime:new Date(0,0,0,0,0,0),endTime:new Date(0,0,0,23,30,0),separator:":",show24Hours:true}})(jQuery)